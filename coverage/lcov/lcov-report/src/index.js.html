<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/index.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">src/</a> index.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">97.4% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>75/77</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">86.96% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>40/46</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>6/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">97.37% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>74/76</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">554×</span>
<span class="cline-any cline-yes">390×</span>
<span class="cline-any cline-yes">164×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">154×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">554×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">90×</span>
<span class="cline-any cline-yes">90×</span>
<span class="cline-any cline-yes">90×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">106×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">106×</span>
<span class="cline-any cline-yes">106×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-yes">80×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">64×</span>
<span class="cline-any cline-yes">64×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">38×</span>
<span class="cline-any cline-yes">38×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// const canvas = window.document.getElementById('canvas')
// const ctx = canvas.getContext('2d')
//
function splitWord(text, wordBreak) {
  text = text.trim()
  if (wordBreak === 'break-all') {
    return text.split('')
  } else {
    var array = text.split('')
    var reg = /[\d\w]/
    return array.reduce(function(newArray, item) {
      if (!reg.test(item) || reg.test(item) &amp;&amp; !reg.test(newArray[newArray.length - 1])) {
        newArray.push(item)
      } else if (!newArray.length) {
        newArray.push(item)
      } else {
        newArray[newArray.length - 1] += item
      }
      return newArray
    }, [])
  }
}
&nbsp;
// // ctx.rect(0, 0, 100, 100)
// // ctx.fill()
//
function getTextLine(ctx, text, fontSize, containerWidth, options) {
  text = text.trim()
  o</span>ptions = options || <span class="branch-1 cbranch-no" title="branch not covered" >{}
  var textOverflow = options.textOverflow
  v</span>ar wordBreak = options.wordBreak || <span class="branch-1 cbranch-no" title="branch not covered" >'keep-all'
  var left = splitWord(text, wordBreak)
  var right = []
  var result = []
  var rest = []
  ctx.font = '' + fontSize + 'Arial'
&nbsp;
  var splitArray = function(textArray) {
    var count = Math.ceil(textArray.length / 2)
    left = textArray.slice(0, count)
    right = textArray.slice(count)
  }
&nbsp;
  var joinText = function(textArrayA, textArrayB) {
    return textArrayA.concat(textArrayB).join('')
  }
&nbsp;
  while (true) {
    var width = ctx.measureText(joinText(result, left)).width
    if (width &lt;= containerWidth) {
      result =  result.concat(left) 
      splitArray(right)
    } else if (left.length === 1) {
      <span class="missing-if-branch" title="if path not taken" >I</span>if (!result.length) {
<span class="cstat-no" title="statement not covered" >        r</span>esult = left
<span class="cstat-no" title="statement not covered" >        r</span>est = right.concat(rest)
      } else {
        rest = left.concat(right, rest)
      }
      break
    } else {
      rest = right.concat(rest)
      splitArray(left)
    }
  }
&nbsp;
  if (typeof textOverflow === 'string' &amp;&amp; textOverflow !== '' || typeof textOverflow === 'undefined') {
    if (textOverflow === 'ellipsis' || typeof textOverflow === 'undefined') {
      var postFix =['...']
    } else {
      var postFix = textOverflow
    }
    result = result.join('').split('')
    result = result.slice(0, result.length - 1).concat(postFix)
    while (true) {
      var width = ctx.measureText(result).width
      if (width &lt;= containerWidth) {
        break
      } else {
        result = result.slice(0, result.length - 2).concat(postFix)
      }
    }
  } else <span class="missing-if-branch" title="if path not taken" >I</span>if (textOverflow !== '') {
&nbsp;
  }
  return {result: result.join('').trim(), rest: rest.join('').trim()}
}
&nbsp;
function wrap(ctx, text, fontSize, containerWidth, options) {
  o</span>ptions = options || <span class="branch-1 cbranch-no" title="branch not covered" >{}
  v</span>ar lineClamp = options.lineClamp || <span class="branch-1 cbranch-no" title="branch not covered" >-1
  var textOverflow = options.textOverflow
  var wordBreak = options.wordBreak || 'keep-all'
  ctx.font = '' + fontSize + 'px'
  var resultArray = []
  var rest = text
  var i = 0
  while (true) {
    if (ctx.measureText(rest).width &lt;= containerWidth) {
      resultArray.push(rest)
      break
    } else {
      var textLineObj = getTextLine(ctx, rest, fontSize, containerWidth, {
        textOverflow: i &gt;= lineClamp - 1 &amp;&amp; lineClamp &gt; 0 ? textOverflow : '', wordBreak})
      var result = textLineObj.result
      var rest = textLineObj.rest
      resultArray.push(result)
    }
    i += 1
    if (i == lineClamp) break
  }
  return resultArray
}
&nbsp;
module.exports = wrap
//
// const text = 'fdsferlf gafr 官方代购 范德萨fads here'
// const textArray = wrap(ctx, text, 20, 100, {lineClamp: 2, wordBreak: 'break-all'})
// console.log(textArray)
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Aug 18 2018 16:37:34 GMT+0800 (CST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
